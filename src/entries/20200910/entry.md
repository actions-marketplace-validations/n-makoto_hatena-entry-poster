# .vue ファイル の template タグ内に ESLint を効かせるために Pug を HTML に移行した話  
  
こんにちは！スマートキャンプで[インサイドセールスに特化した SaaS](https://bales.smartcamp.co.jp/bales-cloud)を作っているエンジニアの中川です。  
上記プロダクトのフロントエンドは Vue.js を用いて開発しているのですが、 その中で SFC 内の`template`タグで使用していた Pug をやめて HTML に移行した件をこの記事ではお話しようと思います。  
また、実際に`template`タグに ESLint を効かせてみて発覚したエラーや警告のなかで数が多かったものや、これから Vue 3 に移行していく上で対応する必要があったルールを紹介します。  
  
## Pug を HTML に移行するには

Pug を HTML に移行するために、AST など静的解析を使って変換するようなツールがないか調べたところ、`vue-pug-to-html`というまさに今回の移行にうってつけな変換ツールを発見し、さらにそこから fork する形で、`@plaidev/pug-to-html`という変換ツールが公開されていたので、今回はそちらを有り難く利用させて頂きました。

また、利用にあたっては制作者である株式会社プレイド様のテックブログに詳細が記載されており、大変参考になりました。
https://tech.plaid.co.jp/pug_to_html/

実際に導入する方法やハマりどころも上記記事にまとめてくださっているので、こちらで再度手順を記載するようなことは行いません。
この場を借りてお礼申し上げます。ありがとうございました！

## Vue 3 に準拠した Lint ルールを導入する

これで Pug がすべて HTML になり、Lint を実行する準備が整いましたが、前述の通り、Lint には Vue 3 に準拠したルールを使用したかったため、以下のリンクに従って導入を進めました。
https://eslint.vuejs.org/user-guide/#installation

また、ルールの適用にあたっては、ルールの優先度ごとにまとめたいくつかのルールセットが用意されているので、それらの中から推奨されている`vue/vue3-recommended`のルールセットを使用しました。
ルールセットの内訳としてはエラーを抑止するための`vue/vue3-essential`、可読性を向上させるための`vue/vue3-strongly-recommended`、任意の選択と認知的オーバーヘッドの最小化のための`vue/vue3-recommended`と用意されており、それぞれのルールセットは前の段階のルールセットを包含するような関係にあります。

### Lint を実行してみる

これで、`template`タグに対して Vue 3 に準拠したルールで Lint を実行する準備が整いました。
これまで Lint されていなかった膨大なコンポーネント（約 300 ファイル）に対して一気に Lint をかけるのは怖いですが、勇気を振り絞って実行してみます。

![エラー出力された様子](./img1.png)

...なるほど。ある程度覚悟していたとはいえ、実際の数字を目にすると心にくるものがありますね。
とはいえこれを見て見ぬ振りをするわけにもいかないので、順番に対処していきました。

ここからは、実際に修正していったうえで、特に目ぼしいルールをいくつか紹介していきます。

## まとめ

上記のものやその他のルール違反をつぶしていった結果、無事に Lint が通るようになりました！

普段の開発に忙殺されてメンテナンスがつい後手に回るようなことはよくありますが、溜まり溜まった負債を一気に解消しようとするのはやはり体力も精神力も必要と痛感したので、今後はこまめに負債と向き合う機会を意識的に設けていきたいです！

今回の対応のなかで、ここでは紹介しきれない細かな問題（Vuetify の 1 系が Vue 2.6 から導入されたスロットのシンタックスに対応しきれていないこと、などなど。。。）もあったりしたので、話を聞いてみたい方は筆者の Twitter（https://twitter.com/let_mkt）にDMいただけると嬉しいです！
また、ここがおかしいなどもあれば上記 Twitter 宛に教えていただけると有り難いです。

[宣伝]

いつもの
